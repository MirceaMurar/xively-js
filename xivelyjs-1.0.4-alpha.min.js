/*! xively-js v1.0.4-alpha | BSD */
(function(){"use strict";var e=this,t=e.jQuery||e.Zepto||e.ender||e.$,s=function(){var e,s="1.0.4-alpha",n="https://api.xively.com/v2",a="ws://api.xively.com:8080",o="https://api.xively.com:8093/sockjs",i=!1,r=function(e){if("function"==typeof e)e.apply(this,Array.prototype.slice.call(arguments,1));else if("[object Array]"===Object.prototype.toString.apply(e))for(var t=e.length;t--;)e[t].apply(this,Array.prototype.slice.call(arguments,1))},u=function(e){window.console&&window.console.log&&window.console.log(e)},c=function(s){var n=t.extend({type:"get"},s);if(!e)return u("(xivelyJS) ::: No API key ::: Set your API key first with xively.setKey( YOUR_API_KEY ) before using any methods. Check docs for more info.");if(n.url){if(n.type=n.type.toUpperCase(),"PUT"===n.type||"POST"===n.type){if(!n.data||"object"!=typeof n.data)return;n.data=JSON.stringify(n.data)}t.ajax({url:n.url,type:n.type,headers:{"X-ApiKey":e},data:n.data,crossDomain:!0,dataType:"json",cache:i}).done(n.done).fail(n.fail).always(n.always)}},d={socket:!1,socketReady:!1,queue:[],resources:[],connect:function(e){var s,n=window.SockJS||window.MozWebSocket||window.WebSocket;!d.socket&&n&&(s=window.SockJS?o:a,d.socket=new n(s),d.socket.onerror=function(e){d.error&&d.error(e,this),d.connect()},d.socket.onclose=function(e){d.close&&d.close(e,this),d.connect()},d.socket.onopen=function(t){d.socketReady=!0,d.open&&d.open(t,this),d.queue.length&&r(d.queue),e&&e(this)},d.socket.onmessage=function(e){var s=e.data,n=JSON.parse(s);n.body&&t("body").trigger("xively."+n.resource,n.body)})},subscribe:function(s,n){var a='{"headers":{"X-ApiKey":"'+e+'"}, "method":"subscribe", "resource":"'+s+'"}';return e?(0>d.resources.indexOf(s)&&(d.resources.push(s),d.socketReady?d.socket.send(a):(d.connect(),d.queue.push(function(){d.socket.send(a)}))),n&&"function"==typeof n&&t(document).on("xively."+s,n),void 0):u("(xivelyJS) ::: No API key ::: Set your API key first with xively.setKey( YOUR_API_KEY ) before using any methods. Check docs for more info.")},unsubscribe:function(t){var s=d.resources.indexOf(t);s>=0&&d.resources.splice(s,1);var n='{"headers":{"X-ApiKey":"'+e+'"}, "method":"unsubscribe", "resource":"'+t+'"}';return e?(d.socket&&d.socket.send(n),void 0):u("(xivelyJS) ::: No API key ::: Set your API key first with xively.setKey( YOUR_API_KEY ) before using any methods. Check docs for more info.")}};return t.ajaxSetup({cache:i}),this.version=function(){return s},this.setKey=function(t){e=t},this.setApiEndpoint=function(e){n=e},this.setWsEndpoint=function(e){a=e},this.setSockJSEndpoint=function(e){o=e},this.apiEndpoint=n,this.request=c,this.subscribe=function(e,t){d.subscribe(e,t)},this.unsubscribe=function(e){d.unsubscribe(e)},this.live=function(e,s){var a=function(n,a){var o=n.current_value?n:a;o.current_value&&t(e).each(function(){t(this).html(o.current_value).attr("data-xively-resource",s)})};c({url:n+s,always:a}),d.subscribe(s,a)},this.stop=function(e){d.unsubscribe(t(e).first().attr("data-xively-resource"))},this.feed={get:function(e,t){c({url:n+"/feeds/"+e,always:t})},update:function(e,t,s){c({type:"put",url:n+"/feeds/"+e+".json",data:t,always:s})},"new":function(e,t){c({type:"post",url:n+"/feeds",data:e,always:t})},"delete":function(e,t){c({type:"delete",url:n+"/feeds/"+e,always:t})},history:function(e,t,s){c({url:n+"/feeds/"+e+".json",data:t,always:s})},list:function(e,t){c({url:n+"/feeds",data:e,always:t})},subscribe:function(e,t){e&&d.subscribe("/feeds/"+e,t)},unsubscribe:function(e){e&&d.unsubscribe("/feeds/"+e)}},this.datastream={get:function(e,t,s){c({url:n+"/feeds/"+e+"/datastreams/"+t+".json",always:s})},update:function(e,t,s,a){c({type:"put",url:n+"/feeds/"+e+"/datastreams/"+t+".json",data:s,always:a})},"new":function(e,t,s){c({type:"post",url:n+"/feeds/"+e+"/datastreams",data:t,always:s})},"delete":function(e,t,s){c({type:"delete",url:n+"/feeds/"+e+"/datastreams/"+t,always:s})},history:function(e,t,s,a){c({url:n+"/feeds/"+e+"/datastreams/"+t+".json",data:s,always:a})},list:function(e,t){c({url:n+"/feeds/"+e+".json",always:function(e){t.call(this,e.datastreams)}})},subscribe:function(e,t,s){e&&t&&d.subscribe("/feeds/"+e+"/datastreams/"+t,s)},unsubscribe:function(e,t){e&&t&&d.unsubscribe("/feeds/"+e+"/datastreams/"+t)},live:function(e,t,s){e&&t&&s&&this.live(e,"/feeds/"+t+"/datastreams/"+s)},stop:function(e){e&&this.stop(e)}},this.datapoint={get:function(e,t,s,a){c({url:n+"/feeds/"+e+"/datastreams/"+t+"/datapoints/"+s,always:a})},update:function(e,t,s,a,o){c({type:"put",url:n+"/feeds/"+e+"/datastreams/"+t+"/datapoints/"+s,data:{value:a},always:o})},"new":function(e,t,s,a){c({type:"post",url:n+"/feeds/"+e+"/datastreams/"+t+"/datapoints",data:s,always:a})},"delete":function(e,t,s,a){var o={type:"delete",always:a};"object"==typeof s?(o.url=n+"/feeds/"+e+"/datastreams/"+t+"/datapoints",o.data=s):o.url=n+"/feeds/"+e+"/datastreams/"+t+"/datapoints/"+s,c(o)},history:function(e,t,s,a){c({url:n+"/feeds/"+e+"/datastreams/"+t+".json",data:s,always:function(e){a.call(this,e.datapoints)}})}},this._settings=function(){return{apiKey:e,apiEndpoint:n,wsEndpoint:a,sockjsEndpoint:o,cacheRequest:i}},this};e.XivelyClient=s,e.xively=e.Xively=new s}).call(this),function(e){var t=function(e){return"object"==typeof e?"/feeds/"+e.feed+(e.datastream?"/datastreams/"+e.datastream:""):"string"==typeof e&&""!==e?e:""},s={live:function(e){return xively.live(this,t(e)),this},get:function(s){var n=e(this);return xively.request({url:xively.apiEndpoint+t(s)+".json",always:function(t){n.each(function(){e(this).html(t.current_value)})}}),this},stop:function(){return xively.stop(this),this}};e.fn.xively=function(t){return s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.xively"),void 0):s.init.apply(this,arguments)}}(jQuery);