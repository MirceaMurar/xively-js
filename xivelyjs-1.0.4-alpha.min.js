/*! xively-js v1.0.4-alpha | BSD */
(function(){"use strict";var e=this,t=e.jQuery||e.Zepto||e.ender||e.$,s=function(e){var s=this,n=!1,a=!1,i=[],o="ws://"+e+":8080",r="https://"+e+":8093/sockjs",u=function(e){if("function"==typeof e)e.apply(this,Array.prototype.slice.call(arguments,1));else if("[object Array]"===Object.prototype.toString.apply(e))for(var t=e.length;t--;)e[t].apply(this,Array.prototype.slice.call(arguments,1))};this.connect=function(e){var c,l=window.SockJS||window.MozWebSocket||window.WebSocket;!n&&l&&(c=window.SockJS?r:o,n=new l(c),n.onerror=function(e){s.error&&s.error(e,this),s.connect()},n.onclose=function(e){s.close&&s.close(e,this),s.connect()},n.onopen=function(t){a=!0,s.open&&s.open(t,this),i.length&&u(i),e&&e(this)},n.onmessage=function(e){var s=e.data,n=JSON.parse(s);n.body&&t("body").trigger("xively."+n.resource,n.body)})},this.send=function(e){a?n.send(e):(this.connect(),i.push(function(){n.send(e)}))}},n=function(e){e=e||"api.xively.com";var n,a=this,i="1.0.4-alpha",o="https://"+e+"/v2",r=!1,u=function(e){window.console&&window.console.log&&window.console.log(e)},c=function(e){var s=t.extend({type:"get"},e);if(!n)return u("(xivelyJS) ::: No API key ::: Set your API key first with xively.setKey( YOUR_API_KEY ) before using any methods. Check docs for more info.");if(s.url){if(s.type=s.type.toUpperCase(),"PUT"===s.type||"POST"===s.type){if(!s.data||"object"!=typeof s.data)return;s.data=JSON.stringify(s.data)}t.ajax({url:s.url,type:s.type,headers:{"X-ApiKey":n,"Content-Type":"application/json","User-Agent":"xively-js/"+i},data:s.data,crossDomain:!0,dataType:"json",cache:r}).done(s.done).fail(s.fail).always(s.always)}},l=[],d=new s(e);return t.ajaxSetup({cache:r}),this._ws=d,this.version=function(){return i},this.setKey=function(e){n=e},this.apiEndpoint=o,this.request=c,this.subscribe=function(e,s){var a='{"headers":{"X-ApiKey":"'+n+'"}, "method":"subscribe", "resource":"'+e+'"}';return n?(0>l.indexOf(e)&&(l.push(e),this._ws.send(a)),s&&"function"==typeof s&&t(document).on("xively."+e,s),void 0):u("(xivelyJS) ::: No API key ::: Set your API key first with xively.setKey( YOUR_API_KEY ) before using any methods. Check docs for more info.")},this.unsubscribe=function(e){if(!n)return u("(xivelyJS) ::: No API key ::: Set your API key first with xively.setKey( YOUR_API_KEY ) before using any methods. Check docs for more info.");var t=l.indexOf(e);t>=0&&(l.splice(t,1),this._ws.send('{"headers":{"X-ApiKey":"'+n+'"}, "method":"unsubscribe", "resource":"'+e+'"}'))},this.live=function(e,s){var n=function(n,a){var i=n.current_value?n:a;i.current_value&&t(e).each(function(){t(this).html(i.current_value).attr("data-xively-resource",s)})};c({url:o+s,always:n}),this.subscribe(s,n)},this.stop=function(e){this.unsubscribe(t(e).first().attr("data-xively-resource"))},this.feed={get:function(e,t){c({url:o+"/feeds/"+e,always:t})},update:function(e,t,s){c({type:"put",url:o+"/feeds/"+e+".json",data:t,always:s})},"new":function(e,t){c({type:"post",url:o+"/feeds",data:e,always:t})},"delete":function(e,t){c({type:"delete",url:o+"/feeds/"+e,always:t})},history:function(e,t,s){c({url:o+"/feeds/"+e+".json",data:t,always:s})},list:function(e,t){c({url:o+"/feeds",data:e,always:t})},subscribe:function(e,t){e&&a.subscribe("/feeds/"+e,t)},unsubscribe:function(e){e&&a.unsubscribe("/feeds/"+e)}},this.datastream={get:function(e,t,s){c({url:o+"/feeds/"+e+"/datastreams/"+t+".json",always:s})},update:function(e,t,s,n){c({type:"put",url:o+"/feeds/"+e+"/datastreams/"+t+".json",data:s,always:n})},"new":function(e,t,s){c({type:"post",url:o+"/feeds/"+e+"/datastreams",data:t,always:s})},"delete":function(e,t,s){c({type:"delete",url:o+"/feeds/"+e+"/datastreams/"+t,always:s})},history:function(e,t,s,n){c({url:o+"/feeds/"+e+"/datastreams/"+t+".json",data:s,always:n})},list:function(e,t){c({url:o+"/feeds/"+e+".json",always:function(e){t.call(this,e.datastreams)}})},subscribe:function(e,t,s){e&&t&&a.subscribe("/feeds/"+e+"/datastreams/"+t,s)},unsubscribe:function(e,t){e&&t&&a.unsubscribe("/feeds/"+e+"/datastreams/"+t)},live:function(e,t,s){e&&t&&s&&a.live(e,"/feeds/"+t+"/datastreams/"+s)},stop:function(e){e&&a.stop(e)}},this.datapoint={get:function(e,t,s,n){c({url:o+"/feeds/"+e+"/datastreams/"+t+"/datapoints/"+s,always:n})},update:function(e,t,s,n,a){c({type:"put",url:o+"/feeds/"+e+"/datastreams/"+t+"/datapoints/"+s,data:{value:n},always:a})},"new":function(e,t,s,n){c({type:"post",url:o+"/feeds/"+e+"/datastreams/"+t+"/datapoints",data:s,always:n})},"delete":function(e,t,s,n){var a={type:"delete",always:n};"object"==typeof s?(a.url=o+"/feeds/"+e+"/datastreams/"+t+"/datapoints",a.data=s):a.url=o+"/feeds/"+e+"/datastreams/"+t+"/datapoints/"+s,c(a)},history:function(e,t,s,n){c({url:o+"/feeds/"+e+"/datastreams/"+t+".json",data:s,always:function(e){n.call(this,e.datapoints)}})}},this._settings=function(){return{apiKey:n,apiHost:e,cacheRequest:r}},this};e.XivelyClient=n,e.xively=e.Xively=new n}).call(this),function(e){var t=function(e){return"object"==typeof e?"/feeds/"+e.feed+(e.datastream?"/datastreams/"+e.datastream:""):"string"==typeof e&&""!==e?e:""},s={live:function(e){return xively.live(this,t(e)),this},get:function(s){var n=e(this);return xively.request({url:xively.apiEndpoint+t(s)+".json",always:function(t){n.each(function(){e(this).html(t.current_value)})}}),this},stop:function(){return xively.stop(this),this}};e.fn.xively=function(t){return s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.xively"),void 0):s.init.apply(this,arguments)}}(jQuery);